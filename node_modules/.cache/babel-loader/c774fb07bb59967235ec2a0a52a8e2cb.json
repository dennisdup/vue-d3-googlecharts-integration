{"remainingRequest":"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/babel-loader/lib/index.js!/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/cache-loader/dist/cjs.js??ref--0-0!/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/vue-loader/lib/index.js??vue-loader-options!/opt/lampp/htdocs/ac_frontend_app/public/development/src/views/record-links.vue?vue&type=script&lang=js&","dependencies":[{"path":"/opt/lampp/htdocs/ac_frontend_app/public/development/src/views/record-links.vue","mtime":1558615142571},{"path":"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport _objectSpread from \"/opt/lampp/htdocs/ac_frontend_app/public/development/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ClickOutside from 'vue-click-outside';\nimport modal from \"./Modal.vue\";\nimport { dataService } from \"./dataService.js\";\nimport grid from \"./Grid.vue\";\nimport axios from 'axios';\nimport Vuex from \"vuex\";\nexport default {\n  data: function data() {\n    return {\n      records: undefined,\n      chosenCompany: 'Select Company',\n      searchQuery: '',\n      showRecordsWindow: false,\n      recordsModal: false,\n      recordTypes: [{\n        readableName: 'Constitutionals',\n        name: 'constitutionals'\n      }, {\n        readableName: 'Resolutions',\n        name: 'resolutions'\n      }, {\n        readableName: 'Agreements',\n        name: 'agreements'\n      }, {\n        readableName: 'Business Plans',\n        name: 'businessplans'\n      }, {\n        readableName: 'Companies Registry Forms',\n        name: 'registryforms'\n      }, {\n        readableName: 'Registers',\n        name: 'members-directors'\n      }, {\n        readableName: 'Policies & Procedures',\n        name: 'policies-procedures'\n      }, {\n        readableName: 'Compliance Plans',\n        name: 'compliance-plans'\n      }, {\n        readableName: 'Compliance Reviews',\n        name: 'compliance-reviews'\n      }, {\n        readableName: 'Compliance Records',\n        name: 'compliance-records'\n      }, {\n        readableName: 'SFC Correspondences',\n        name: 'correspondences'\n      }],\n      headers: [{\n        title: 'Name',\n        path: 'name'\n      }, {\n        title: 'Company Name',\n        path: 'companyname'\n      }, {\n        title: 'Date',\n        path: 'date'\n      }, {\n        title: 'Note',\n        path: 'note'\n      }, {\n        title: 'Image',\n        type: 'link',\n        path: 'image'\n      }, {\n        title: 'Added',\n        path: 'added',\n        bool: true\n      }, {\n        title: 'Actions',\n        actions: [{\n          name: 'Add',\n          class: 'text-success',\n          show: 'showAdd'\n        }, {\n          name: 'Remove',\n          class: 'text-danger',\n          show: 'showRemove'\n        }]\n      }],\n      headers1: [{\n        title: 'Type',\n        path: 'readableType'\n      }, {\n        title: 'Name',\n        path: 'name'\n      }, {\n        title: 'Date',\n        path: 'date'\n      }, {\n        title: 'Image',\n        type: 'link',\n        path: 'image'\n      }, {\n        title: 'Note',\n        path: 'note'\n      }, {\n        title: 'Actions',\n        actions: [{\n          name: 'Remove',\n          class: 'text-danger'\n        }]\n      }]\n    };\n  },\n  methods: {\n    addRecord: addRecord,\n    clickOutsideLinks: clickOutsideLinks,\n    getReadableActiveType: getReadableActiveType,\n    cellClick: cellClick,\n    'Add': addItem,\n    'Remove': removeItem,\n    'download': download\n  },\n  props: {\n    step: Object\n  },\n  computed: _objectSpread({\n    recordsFiltered: function recordsFiltered() {\n      var _this = this;\n\n      var r = this.records;\n\n      if (this.searchQuery) {\n        r = r.filter(function (r) {\n          return r.name.toLowerCase().includes(_this.searchQuery) || r.companyname.toLowerCase().includes(_this.searchQuery);\n        });\n      }\n\n      if (this.chosenCompany && this.chosenCompany !== 'Select Company') {\n        r = r.filter(function (r) {\n          return r.companyname === _this.chosenCompany;\n        });\n      }\n\n      return r;\n    }\n  }, Vuex.mapState({\n    stageurl: 'stageurl'\n  })),\n  components: {\n    modal: modal,\n    grid: grid\n  },\n  directives: {\n    ClickOutside: ClickOutside\n  }\n};\n\nfunction download() {\n  return;\n}\n\nfunction removeItem(id) {\n  var self = this;\n  self.step.recordLinks.splice(self.step.recordLinks.map(function (s) {\n    return s._id;\n  }).indexOf(id), 1);\n  var itemToAdd = self.records.find(function (r) {\n    return r._id === id;\n  });\n  itemToAdd.added = !itemToAdd.added;\n  itemToAdd.showAdd = !itemToAdd.added;\n  itemToAdd.showRemove = itemToAdd.added;\n}\n\nfunction cellClick(id, action) {\n  if (!id) return;\n  this[action](id);\n}\n\nfunction addItem(id) {\n  var itemToAdd = this.records.find(function (r) {\n    return r._id === id;\n  });\n  itemToAdd.added = !itemToAdd.added;\n  itemToAdd.showAdd = !itemToAdd.added;\n  itemToAdd.showRemove = itemToAdd.added;\n  var i = {\n    'type': this.activeType,\n    'readableType': this.getReadableActiveType(this.activeType),\n    'name': itemToAdd.name,\n    '_id': itemToAdd._id,\n    'date': itemToAdd.date,\n    note: itemToAdd.note,\n    'image': itemToAdd.image\n  };\n\n  if (this.step.hasOwnProperty('recordLinks')) {\n    this.step.recordLinks.push(i);\n  } else {\n    this.$set(this.step, 'recordLinks', [i]);\n  }\n}\n\nfunction getReadableActiveType() {\n  var _this2 = this;\n\n  return this.recordTypes.find(function (r) {\n    return r.name === _this2.activeType;\n  }).readableName;\n}\n\nfunction clickOutsideLinks() {\n  var _this3 = this;\n\n  this.$nextTick(function () {\n    _this3.showRecordsWindow = false;\n  });\n}\n\nfunction addRecord(type) {\n  var _this4 = this;\n\n  this.activeType = type;\n  this.records = undefined;\n  this.recordsModal = true;\n  this.showRecordsWindow = false;\n  if (!this.step.recordLinks) this.$set(this.step, 'recordLinks', []);\n  axios.get(\"\".concat(this.stageurl, \"/\").concat(type)).then(function (resp) {\n    resp.data.content = resp.data.content.filter(function (r) {\n      return r.company;\n    });\n    resp.data.content.forEach(function (r) {\n      r.added = _this4.step.recordLinks.map(function (l) {\n        return l._id;\n      }).includes(r._id);\n      r.companyname = r.company.name;\n      r.showAdd = !r.added;\n      r.showRemove = r.added;\n    });\n    _this4.records = resp.data.content;\n    _this4.companyNames = _this4.records.map(function (r) {\n      return r.companyname;\n    }).filter(function (c, ind, arr) {\n      return arr.indexOf(c) === ind;\n    }).sort(function (a, b) {\n      return a.localeCompare(b);\n    });\n  }, function (error) {\n    console.log(\"Unable to fetch data, give error on page\");\n  });\n}",{"version":3,"sources":["record-links.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div v-click-outside=\"clickOutsideLinks\" id=\"record-links\">\n    <div class=\"relative\">\n        <div class=\"d-flex flex-row bd-highlight mb-3\">\n          <div class=\"p-2 bd-highlight\">\n            Display Compliance Records \n          </div>\n          <div class=\"ml-auto p-2 bd-highlight\">\n            <div class=\"pull-right\">\n              <div class=\"dropdown\">\n                <button class=\"btn btn-secondary dropdown-toggle\" type=\"button\" \n                id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                  Add\n                </button>\n                <div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n                  <a class=\"dropdown-item\" v-for=\"record in recordTypes\" @click=\"addRecord(record.name)\" v-text=\"record.readableName\"></a>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>      \n      <grid v-if=\"step.recordLinks\" class=\"grid\"\n        :data=\"step.recordLinks\"\n        @clickCell=\"cellClick\"\n        :columns=\"headers1\"\n        :rowsPerPage=\"10\">\n      </grid>\n    </div>\n\n    <modal v-if=\"recordsModal\" @close=\"recordsModal = false;\">\n      <h3 slot=\"header\">{{getReadableActiveType()}}</h3>\n      <div slot=\"body\" >\n        <div class=\"d-flex justify-content-center\">\n          <div v-show=\"!records\">\n            <div class=\"spinner-border\" role=\"status\">\n              <span class=\"sr-only\">Loading...</span>\n            </div>\n          </div>\n        </div>\n        <div v-if=\"records\" class=\"flex\">\n          <div class=\"dropdown\">\n            <button class=\"btn btn-secondary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" \n            data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n              <span v-text=\"chosenCompany || '-'\"></span>\n            </button>\n            <div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n              <a class=\"dropdown-item\" v-for=\"company in companyNames\" @click=\"chosenCompany = company;\">{{company}}</a>\n            </div>\n          </div>\n          <div class=\"form-group mt-3\">\n            <input type=\"text\" name=\"searchQuery\" class=\"form-control\" placeholder=\"SEARCH\" v-model=\"searchQuery\">\n          </div>\n        </div>\n\n        <grid v-if=\"records\" class=\"grid\"\n          :data=\"recordsFiltered\"\n          @clickCell=\"cellClick\"\n          :columns=\"headers\"\n          :rowsPerPage=\"10\">\n        </grid>\n      </div>\n      <div slot=\"footer\" v-show=\"records\">\n        <button class=\"btn btn-sm btn-success\" @click=\"recordsModal = false;\">OK</button>\n      </div>\n    </modal>\n\n\n  </div>\n</template>\n<script>\nimport ClickOutside from 'vue-click-outside'\nimport modal from './Modal.vue';\nimport { dataService } from './dataService.js';\nimport grid from './Grid.vue';\nimport axios from 'axios';\nimport Vuex from \"vuex\";\n\nexport default {\n  data() {\n    return {\n      records: undefined, chosenCompany: 'Select Company', searchQuery: '',\n      showRecordsWindow: false,\n      recordsModal: false,\n      recordTypes: [\n        {readableName: 'Constitutionals', name: 'constitutionals'},\n        {readableName: 'Resolutions', name: 'resolutions'},\n        {readableName: 'Agreements', name: 'agreements'},\n        {readableName: 'Business Plans', name: 'businessplans'},\n        {readableName: 'Companies Registry Forms', name: 'registryforms'},\n        {readableName: 'Registers', name: 'members-directors'},\n        {readableName: 'Policies & Procedures', name: 'policies-procedures'},\n        {readableName: 'Compliance Plans', name: 'compliance-plans'},\n        {readableName: 'Compliance Reviews', name: 'compliance-reviews'},\n        {readableName: 'Compliance Records', name: 'compliance-records'},\n        {readableName: 'SFC Correspondences', name: 'correspondences'},\n      ],\n      headers: [\n        {\n          title: 'Name',\n          path: 'name'\n        },{\n          title: 'Company Name',\n          path: 'companyname'\n        }, {\n          title: 'Date',\n          path: 'date'\n        },\n        {\n          title: 'Note',\n          path: 'note'\n        }, {\n          title: 'Image',\n          type: 'link',\n          path: 'image'\n        },\n        {\n          title: 'Added',\n          path: 'added',\n          bool: true\n        },\n        {title: 'Actions',actions: [{name: 'Add', class: 'text-success', show: 'showAdd'},{name: 'Remove', class: 'text-danger', show: 'showRemove'}]}\n      ],\n      headers1: [\n        {\n          title: 'Type',\n          path: 'readableType'\n        },{\n          title: 'Name',\n          path: 'name'\n        }, {\n          title: 'Date',\n          path: 'date'\n        }, {\n          title: 'Image',\n          type: 'link',\n          path: 'image'\n        },\n        {\n          title: 'Note',\n          path: 'note'\n        },\n        {title: 'Actions',actions: [{name: 'Remove', class: 'text-danger'}]}\n      ]\n    }\n  },\n  methods: {\n    addRecord, clickOutsideLinks, getReadableActiveType, cellClick,\n    'Add': addItem,\n    'Remove': removeItem,\n    'download': download\n  },\n  props: {\n    step: Object\n  },\n  computed: {\n    recordsFiltered: function() {\n      let r = this.records;\n      if (this.searchQuery) {\n        r = r.filter(r => r.name.toLowerCase().includes(this.searchQuery) || r.companyname.toLowerCase().includes(this.searchQuery));\n      }\n      if (this.chosenCompany && this.chosenCompany !== 'Select Company') {\n        r = r.filter(r => r.companyname === this.chosenCompany);\n      }\n\n      return r;\n    },\n    ...Vuex.mapState({\n            stageurl : 'stageurl'\n    }),\n  },\n  components: {\n    modal, grid\n  },\n  directives: {\n    ClickOutside\n  }\n}\n\nfunction download() {\n  return;\n}\n\nfunction removeItem(id) {\n  let self = this;\n  self.step.recordLinks.splice(self.step.recordLinks.map(s => s._id).indexOf(id), 1);\n  let itemToAdd = self.records.find(r => r._id === id);\n  itemToAdd.added = !itemToAdd.added;\n  itemToAdd.showAdd = !itemToAdd.added;\n  itemToAdd.showRemove = itemToAdd.added;\n}\nfunction cellClick(id, action) {\n  if (!id) return;\n  this[action](id);\n}\n\nfunction addItem(id) {\n  let itemToAdd = this.records.find(r => r._id === id);\n  itemToAdd.added = !itemToAdd.added;\n  itemToAdd.showAdd = !itemToAdd.added;\n  itemToAdd.showRemove = itemToAdd.added;\n  let i = {'type': this.activeType, 'readableType': this.getReadableActiveType(this.activeType), 'name': itemToAdd.name, '_id': itemToAdd._id, 'date': itemToAdd.date, note: itemToAdd.note, 'image': itemToAdd.image};\n  if (this.step.hasOwnProperty('recordLinks')) {\n    this.step.recordLinks.push(i);\n  } else {\n    this.$set(this.step, 'recordLinks', [i]);\n  }\n}\n\nfunction getReadableActiveType() {\n  return this.recordTypes.find(r => r.name === this.activeType).readableName;\n}\n\nfunction clickOutsideLinks() {\n  this.$nextTick(() => {\n    this.showRecordsWindow = false;\n  });\n}\n\nfunction addRecord(type) {\n  this.activeType = type;\n  this.records = undefined;\n  this.recordsModal = true;\n  this.showRecordsWindow = false;\n  if (!this.step.recordLinks) this.$set(this.step, 'recordLinks', []);\n  axios.get(`${this.stageurl}/${type}`).then(\n    resp => {\n        resp.data.content = resp.data.content.filter(r => r.company);\n        resp.data.content.forEach(r => {\n          r.added = this.step.recordLinks.map(l => l._id).includes(r._id);\n          r.companyname = r.company.name;\n          r.showAdd = !r.added;\n          r.showRemove = r.added;\n        });\n        this.records = resp.data.content;\n        this.companyNames = this.records.map(r => r.companyname).filter((c, ind, arr) => arr.indexOf(c) === ind).sort((a, b) => a.localeCompare(b));\n  }, (error)=>  {\n      console.log(\"Unable to fetch data, give error on page\");\n  });\n\n}\n\n</script>\n<style type=\"text/css\">\n  #record-links .forms-window {\n    top: 20px;\n    left: 30px;\n    right: unset;\n  }\n</style>"],"sourceRoot":"src/views"}]}